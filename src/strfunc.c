/******************************************************************************/
/*      X Y M O N   L I B R A R Y   -   S T R I N G   F U N C T I O N S       */
/*                                                                  */
/*  functions:                                                */
/*      - add2buffer                                              */
/*                                                            */
/******************************************************************************/

/******************************************************************************/
/*   I N C L U D E S                                                          */
/******************************************************************************/

// ---------------------------------------------------------
// system
// ---------------------------------------------------------
#include <string.h>
#include <stdlib.h>

// ---------------------------------------------------------
// own 
// ---------------------------------------------------------
#include <strfunc.h>

/******************************************************************************/
/*   G L O B A L S                                                            */
/******************************************************************************/

/******************************************************************************/
/*   D E F I N E S                                                            */
/******************************************************************************/
#define BUFSZINCREMENT 4096

/******************************************************************************/
/*   M A C R O S                                                              */
/******************************************************************************/

/******************************************************************************/
/*   P R O T O T Y P E S                                                      */
/******************************************************************************/

/******************************************************************************/
/*                                                                            */
/*   F U N C T I O N S                                                        */
/*                                                                            */
/******************************************************************************/

/******************************************************************************/
/*  add to buffer                                                      */
/******************************************************************************/
void add2buffer(tStrbuffer *buf, char *newtext)
{
  if (!newtext)  return ;

  int newlen = strlen( newtext ) ;


  if (buf->s == NULL)
  {
    buf->used = 0;
    buf->sz = newlen + BUFSZINCREMENT;
    buf->s = (char *) malloc(buf->sz);
    *(buf->s) = '\0';
  }
  else if ((buf->used + newlen + 1) > buf->sz)
  {
    buf->sz += (newlen + BUFSZINCREMENT);
    buf->s = (char *) realloc(buf->s, buf->sz);
  }

  if (newtext)
  {
    memcpy(buf->s+buf->used, newtext, newlen);
    buf->used += newlen;
    // Make sure result buffer is NUL-terminated; newtext might not be.
    *(buf->s + buf->used) = '\0';
  }
}


